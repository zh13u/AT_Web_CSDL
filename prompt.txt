Dán nguyên khối sau vào **Claude Sonnet 4.5** để sinh **toàn bộ mã FE** (Next.js + TypeScript + Tailwind + shadcn/ui) chạy được trên **localhost**. Chỉ FE, có **API mock** nội bộ để kiểm tra luồng (sau này thay bằng Spring Boot thật).

---

# PROMPT: Sinh mã FE Next.js (React + TS) cho Website Bán Điện Thoại

Bạn là **senior frontend engineer**. Hãy tạo **toàn bộ mã nguồn FE** cho website **bán điện thoại** (tham khảo luồng UI từ cellphones.com.vn nhưng **chỉ** danh mục Điện thoại). **Chỉ FE**, không backend thật. Tạo **API mock** bằng Next.js Route Handlers (thư mục `app/api/*`) để chạy trên localhost.

## 0) Kết quả mong muốn
- Dự án Next.js 14 (App Router) + TypeScript **chạy được trên localhost**: `pnpm i && pnpm dev` → http://localhost:3000
- Có sẵn **pages/screens**, **components**, **CSS/Tailwind**, **state**, **form**, **API mock** (đọc/ghi tạm), **README** hướng dẫn kết nối Spring Boot sau này.
- **Tuyệt đối không** dùng `dangerouslySetInnerHTML` (trừ khi dữ liệu đã sanitize), không lưu token ở localStorage.

## 1) Tech stack
- **Next.js 14** (App Router) + **TypeScript**
- **Tailwind CSS** + `tailwindcss-animate` + **shadcn/ui** (vendor sẵn các component cần)
- **Icon**: `lucide-react`
- **State**: `zustand` (UI) + **TanStack Query** (data fetching/cache)
- **Form**: React Hook Form + Zod
- **i18n**: Tiếng Việt mặc định (file `vi.json`)
- **HTTP**: `fetch` với `{ credentials: 'include' }` (tương thích cookie HttpOnly từ Spring)
- **Sanitize**: `dompurify` (chỉ dùng khi bắt buộc phải render HTML từ server)
- **Mock API**: Next Route Handlers trong `app/api/*` (không phụ thuộc internet)

## 2) Cấu trúc thư mục & route
```
app/
  (marketing)/page.tsx                    // Trang chủ
  dien-thoai/page.tsx                     // Danh sách điện thoại + filter/sort/pagination
  dien-thoai/[slug]/page.tsx              // Chi tiết + gallery/video/biến thể/stock
  search/page.tsx                         // Tìm kiếm q=...
  cart/page.tsx                           // Giỏ hàng
  checkout/page.tsx                       // Thanh toán (mock)
  auth/login/page.tsx
  auth/register/page.tsx
  auth/forgot/page.tsx
  account/page.tsx                        // Hồ sơ, đơn hàng, viết đánh giá (sau mua)
  chinh-sach-bao-hanh/page.tsx
  chinh-sach-doi-tra/page.tsx
  lien-he/page.tsx

  api/
    products/route.ts                     // GET danh sách (filter/sort/paginate)
    products/[slug]/route.ts              // GET chi tiết
    search/route.ts                       // GET gợi ý/tìm kiếm
    auth/register/route.ts                // mock
    auth/login/route.ts                   // mock (set cookie mô phỏng)
    auth/forgot/route.ts                  // mock
    cart/route.ts                         // GET/POST giỏ hàng (mock by cookie/session id)
    orders/route.ts                       // POST đặt hàng (mock)
    products/[id]/reviews/route.ts        // GET/POST review (mock)
    uploads/sign/route.ts                 // Trả về "fake pre-signed URL" để FE PUT (mock)

components/
  (UI cơ bản: Header, Footer, ProductCard, ProductGrid, FilterSidebar, SortBar, Breadcrumbs,
   Pagination/InfiniteLoader, VariantSelector, AddToCart, RatingStars, ReviewList, ReviewForm,
   MediaPreview, CartDrawer, Toast)
lib/
  api.ts          // wrapper fetch + credentials + CSRF header
  schemas.ts      // Zod schemas (auth, review, filters)
  utils.ts        // helpers (format tiền, encode URL params…)
store/
  cart.ts         // zustand cho UI cart (sync với API)
  ui.ts
hooks/
  useAuth.ts, useFilters.ts, ...
public/
  logo.svg, placeholders/*
styles/
  globals.css
tailwind.config.ts
```

## 3) Dữ liệu & types
```ts
export type Product = {
  id: string; slug: string; name: string; brand: string;
  price: number; salePrice?: number; thumbnail: string;
  rating: number; ratingCount: number; isHot?: boolean; isNew?: boolean;
};

export type Variant = { color: string; storage: string; sku: string; stock: number };

export type ProductDetail = Product & {
  gallery: string[];
  videos?: { url: string; poster?: string }[];
  specs: {
    chipset: string; ram: string; rom: string; battery: string;
    display: { size: string; type: string; resolution: string };
    camera: { rear: string; front: string };
    charging: string; os: string; weight?: string;
  };
  variants: Variant[];
  descriptionHTMLSafe?: string; // chỉ render khi chắc chắn đã sanitize
};

export type Review = {
  id: string;
  user: { name: string; verifiedPurchase: boolean };
  rating: number; content: string; createdAt: string;
  media?: { type: 'image'|'video'; url: string; poster?: string }[];
};
```

## 4) Mock API contract (để FE chạy localhost)
- `GET /api/products?category=phone&brand=&price=10-15&ram=8gb&sort=price_asc&page=1&pageSize=24`
  - Trả `{ items: Product[], total, page, pageSize }`
- `GET /api/products/[slug]` → `ProductDetail`
- `GET /api/search?q=...` → `{ items: Product[] }`
- Auth (mock): `POST /api/auth/register`, `POST /api/auth/login`, `POST /api/auth/forgot`
  - Login mock: set cookie session (non-HttpOnly để demo). **README** ghi rõ khi nối Spring sẽ dùng **HttpOnly+Secure**.
- Cart/Order (mock): `GET/POST /api/cart`, `POST /api/orders`
- Reviews:
  - `GET /api/products/[id]/reviews?page=...`
  - `POST /api/products/[id]/reviews` (giả lập kiểm tra “verifiedPurchase”)
- Upload:
  - `POST /api/uploads/sign` → `{ url, method, headers }` (fake)
  - FE `PUT` file vào `url` (mock route nhận dữ liệu và trả 200), sau đó gửi review kèm danh sách URL.

## 5) Thành phần UI tối thiểu
- `Header` (logo, search, menu Điện thoại, mini-cart)
- `Footer`
- `ProductCard`, `ProductGrid`, `Price`, `Badge`, `RatingStars`
- `FilterSidebar`, `SortBar`, `Breadcrumbs`, `Pagination` hoặc `InfiniteLoader`
- `VariantSelector`, `AddToCart`
- `ReviewList`, `ReviewForm` (upload media), `MediaPreview`
- `AuthForms` (Login/Register/Forgot), `ProfileForm`
- `CartDrawer` (mini-cart), `Toast` (shadcn/ui)

## 6) Tìm kiếm & Bộ lọc
- Search box trên header: debounce 300ms, highlight từ khóa trong gợi ý.
- Bộ lọc đồng bộ query string (`?brand=samsung&price=10-15&ram=8gb...`).
- Giữ trạng thái khi quay lại (preserve scroll, URL state).

## 7) Luồng đánh giá sau mua + upload media
- Form: rating 1–5, nội dung, **tối đa 5 media** (ảnh: jpg/png/webp ≤ 3MB; video: mp4/webm ≤ 20MB, tổng ≤ 50MB).
- Kiểm MIME + giới hạn size ở FE; **không** nhận `.svg/.html`.
- Preview thumbnail; video có `poster`.
- Upload flow: xin pre-signed URL → PUT file (hiển thị % tiến độ) → gửi review chứa danh sách URL.
- Nếu chưa “verifiedPurchase”, ẩn form hoặc hiển thị tooltip.

## 8) Bảo mật FE (rất quan trọng)
- **Không** dùng `dangerouslySetInnerHTML`. Nếu buộc phải render HTML mô tả sản phẩm, chỉ render `descriptionHTMLSafe` đã được backend sanitize; hoặc sanitize ở FE bằng `dompurify` trước khi render.
- Mọi `fetch` tới API thật (sau này) phải có `credentials: 'include'` và gắn header `X-XSRF-TOKEN` lấy từ cookie không-HttpOnly (token do Spring cấp).
- **Không** lưu JWT/session trong localStorage/sessionStorage.
- Không bind user-input vào `style`/`url()` CSS.
- Upload: kiểm tra MIME + magic bytes nhẹ nhàng (ở FE nếu có thể), chặn SVG/HTML cải trang.
- README kèm ví dụ cấu hình Spring Security (CSP, CSRF, cookies) – chỉ mô tả, **không** implement BE.

## 9) SEO, A11y, Performance
- SEO: metadata động, Open Graph, JSON-LD Product.
- A11y: semantic landmarks, aria-label, focus ring rõ, trap focus trong modal.
- Hiệu năng: Next/Image, blur placeholder, dynamic import cho gallery/video, cache với TanStack Query (`staleTime` hợp lý), prefetch khi hover.

## 10) Chất lượng & Tooling
- ESLint + Prettier + strict TS.
- Lighthouse ≥ 90 cho Performance/Accessibility/Best Practices/SEO (trên mock).
- Unit test cơ bản (ví dụ: `ProductCard`, `ReviewForm` validation).

## 11) Hệ thống CSS & UI (Tailwind + CSS Variables + shadcn/ui)
### 11.1 `tailwind.config.ts` (tạo file đúng nội dung)
```ts
import type { Config } from "tailwindcss";

const config: Config = {
  darkMode: ["class"],
  content: ["./app/**/*.{ts,tsx}", "./components/**/*.{ts,tsx}", "./lib/**/*.{ts,tsx}"],
  theme: {
    container: { center: true, padding: "1rem", screens: { "2xl": "1280px" } },
    extend: {
      colors: {
        bg: "hsl(var(--bg))",
        surface: "hsl(var(--surface))",
        text: "hsl(var(--text))",
        muted: "hsl(var(--muted))",
        border: "hsl(var(--border))",
        brand: { DEFAULT: "hsl(var(--brand))", fg: "hsl(var(--brand-fg))", dark: "hsl(var(--brand-dark))" },
        success: "hsl(var(--success))",
        warning: "hsl(var(--warning))",
        danger: "hsl(var(--danger))",
      },
      boxShadow: {
        soft: "0 20px 60px rgba(15, 23, 42, .08)",
        card: "0 20px 35px rgba(15, 23, 42, .08)",
      },
      borderRadius: { lg: "1.5rem", md: "1rem", sm: ".75rem" },
      keyframes: {
        shimmer: { "0%": { transform: "translateX(-100%)" }, "100%": { transform: "translateX(100%)" } },
        in: { from: { opacity: 0, transform: "translateY(6px)" }, to: { opacity: 1, transform: "translateY(0)" } },
      },
      animation: { shimmer: "shimmer 1.2s linear infinite", in: "in .18s ease-out" },
    },
  },
  plugins: [require("tailwindcss-animate")],
};

export default config;
```

### 11.2 `styles/globals.css` (tạo file đúng nội dung)
```css
@tailwind base;
@tailwind components;
@tailwind utilities;

/* ===== Tokens (Light/Dark) ===== */
:root{
  --bg:225 33% 98%; --surface:0 0% 100%; --text:212 24% 16%; --muted:215 12% 45%; --border:215 20% 88%;
  --brand:232 45% 58%; --brand-dark:232 45% 44%; --brand-fg:0 0% 100%;
  --success:150 60% 40%; --warning:35 90% 52%; --danger:0 72% 54%;
}
.dark{
  --bg:230 35% 7%; --surface:230 30% 11%; --text:220 15% 92%; --muted:215 12% 70%; --border:220 12% 22%;
  --brand:232 45% 62%; --brand-dark:232 45% 52%; --brand-fg:0 0% 100%;
}

/* ===== Base ===== */
html,body{ @apply h-full; }
body{ @apply bg-bg text-text antialiased; font-feature-settings:"cv02","cv03","cv04","cv11"; }
a{ @apply text-brand hover:text-brand-dark transition-colors; }
img,video{ @apply max-w-full h-auto; }
*:focus-visible{ @apply outline-none ring-2 ring-brand/60 ring-offset-2 ring-offset-surface; }

/* ===== Helpers ===== */
.container-narrow{ @apply container max-w-5xl; }
.shadow-card{ @apply shadow-card; }
.card{ @apply rounded-2xl bg-surface shadow-card border border-border; }
.badge{ @apply inline-flex items-center rounded-full px-2.5 py-0.5 text-xs bg-brand text-brand-fg; }
.muted{ @apply text-muted; }
.sr-only{ @apply sr-only; }

/* ===== Buttons ===== */
.btn{ @apply inline-flex items-center justify-center rounded-xl px-4 py-2 text-sm font-medium transition-colors select-none disabled:opacity-50 disabled:cursor-not-allowed; }
.btn-primary{ @apply btn bg-brand text-brand-fg hover:bg-brand-dark; }
.btn-ghost{ @apply btn bg-transparent hover:bg-border; }
.btn-outline{ @apply btn border border-border hover:bg-border; }

/* ===== Product Card ===== */
.product-card{ @apply card p-4 relative overflow-hidden transition-transform duration-150; }
.product-card:hover{ transform:translateY(-2px); }
.product-thumb{ @apply aspect-[4/3] w-full rounded-xl bg-border overflow-hidden; }
.price{ @apply text-lg font-semibold; }
.price .sale{ @apply text-danger font-semibold; }
.price .strike{ @apply line-through text-muted ml-2 text-sm; }

/* ===== Grid & Layout ===== */
.grid-products{ @apply grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-4 sm:gap-6; }
.section{ @apply py-10 sm:py-14; }
.section-title{ @apply text-2xl sm:text-3xl font-semibold mb-6; }

/* ===== Review: media grid + dropzone ===== */
.review-media-grid{ @apply grid grid-cols-3 sm:grid-cols-5 gap-2; }
.review-media-grid .item{ @apply aspect-square rounded-lg bg-border overflow-hidden relative; }
.dropzone{ @apply border-2 border-dashed border-border rounded-2xl p-6 text-center text-sm text-muted hover:border-brand focus-within:border-brand transition-colors; }
.dropzone.dragover{ @apply border-brand bg-brand/5; }

/* ===== Skeleton (loading) ===== */
.skeleton{ @apply relative overflow-hidden rounded-xl bg-border; }
.skeleton::after{
  content:""; @apply absolute inset-0 -translate-x-full;
  background-image:linear-gradient(90deg,transparent,rgba(255,255,255,.45),transparent);
  animation:shimmer 1.2s linear infinite;
}

/* ===== Progress (upload) ===== */
.progress{ @apply h-2 w-full rounded-full bg-border overflow-hidden; }
.progress>span{ @apply block h-full bg-brand; }

/* ===== Rating stars ===== */
.stars{ @apply inline-flex items-center gap-0.5 align-middle; }
.stars .star{ @apply w-4 h-4 text-warning; }

/* ===== Dialog/Drawer ===== */
.dialog-body{ @apply p-4 sm:p-6; }
.drawer{ @apply fixed inset-y-0 right-0 w-full sm:w-[420px] bg-surface border-l border-border shadow-soft; }

/* ===== Forms ===== */
.input{ @apply w-full rounded-xl border border-border bg-surface px-3 py-2 text-sm outline-none focus:border-brand; }
.label{ @apply block text-sm font-medium mb-1; }
.help{ @apply text-xs text-muted mt-1; }

@media (prefers-reduced-motion: reduce){
  *{ animation:none !important; transition:none !important; }
}
```

### 11.3 Ví dụ JSX dùng class
```tsx
<div className="product-card group">
  <div className="product-thumb">{/* <Image ... className="object-contain" fill /> */}</div>
  <h3 className="mt-3 line-clamp-2 text-sm font-medium">iPhone 15 Pro Max Titanium</h3>
  <div className="mt-2 price">
    <span className="sale">29.990.000₫</span>
    <span className="strike">33.990.000₫</span>
  </div>
  <div className="mt-3 flex items-center justify-between">
    <button className="btn-outline">Thêm vào giỏ</button>
    <button className="btn-primary">Mua ngay</button>
  </div>
</div>
```

## 12) UX chi tiết theo trang
- Trang chủ `/`: Banner nhỏ, danh mục **Điện thoại**, grid **Top bán chạy**, **Flash sale**.
- `/dien-thoai`: Filter theo Brand/Price/RAM/ROM/5G, Sort (Mới nhất/Giá ↑/↓/Bán chạy), Pagination/Infinite.
- `/dien-thoai/[slug]`: Gallery ảnh, video, biến thể (màu/dung lượng) và tồn kho theo biến thể; giá, khuyến mãi, “Chính hãng/Trả góp”; Nút Thêm vào giỏ/Mua ngay; khu **Đánh giá**.
- `/search`: Kết quả + gợi ý.
- `/cart`, `/checkout`: giỏ hàng + quy trình đặt hàng (mock).
- `/auth/*`: Đăng ký/Đăng nhập/Quên mật khẩu với RHF + Zod, lỗi hiển thị thân thiện.
- `/account`: Hồ sơ, đơn hàng; cho phép **viết đánh giá** cho đơn “đã mua”.

## 13) Tích hợp bảo mật với Spring Boot (ghi trong README, không code BE)
- FE **không** lưu token; dựa vào cookie **HttpOnly + Secure + SameSite** do Spring cấp.
- FE mọi `fetch` tới BE thật: `credentials: 'include'` + header `X-XSRF-TOKEN` đọc từ cookie `XSRF-TOKEN`.
- Không render HTML chưa sanitize; nếu có `descriptionHTMLSafe`, giả định BE đã sanitize.
- Gợi ý CSP (ghi README), **không** đặt header trong FE.

## 14) Package & scripts
- `package.json` cần các script:
  - `"dev": "next dev"`
  - `"build": "next build"`
  - `"start": "next start"`
  - `"lint": "next lint"`
- Dependencies chính:
  - `next`, `react`, `react-dom`, `typescript`, `@types/node`, `@types/react`
  - `tailwindcss`, `postcss`, `autoprefixer`, `tailwindcss-animate`
  - `lucide-react`, `zustand`, `@tanstack/react-query`, `react-hook-form`, `zod`, `dompurify`
  - (Vendor sẵn các component cần từ shadcn/ui trong `components/ui/*` để không phải chạy CLI)

## 15) README (bắt buộc tạo)
- Cách chạy local:
  ```
  pnpm i
  pnpm dev
  ```
- Mô tả API mock trong `app/api/*`, cách thay thế base URL để nối Spring Boot thật.
- Lưu ý bảo mật khi nối Spring:
  - Cookie HttpOnly + Secure + SameSite, CORS allow origin FE cụ thể.
  - CSRF: FE gắn `X-XSRF-TOKEN` từ cookie; `fetch(..., { credentials:'include' })`.
  - CSP ở BE: ví dụ `default-src 'self'; script-src 'self' 'nonce-...'; style-src 'self' 'unsafe-inline'; img-src 'self' data: blob:; media-src 'self' blob:; object-src 'none'; base-uri 'self'; frame-ancestors 'none'`.
- Checklist XSS/CSRF như mục 8.

## 16) Tiêu chí hoàn thành
- Chạy `pnpm dev` hiển thị đầy đủ trang & luồng cơ bản (auth mock, thêm giỏ hàng, checkout mock, viết review kèm upload media mock).
- Lighthouse ≥ 90 cho 4 hạng mục trên trang danh sách & chi tiết.
- Không sử dụng `dangerouslySetInnerHTML` vào dữ liệu chưa sanitize.

> **Yêu cầu đầu ra:**  
> - In ra **toàn bộ cây thư mục** với **từng file và nội dung đầy đủ** (không rút gọn).  
> - Nếu quá dài, chia làm nhiều khối theo thư mục (app/, components/, lib/, store/, styles/, package.json, tailwind.config.ts, README.md…).  
> - Bảo đảm project chạy được **ngay trên localhost** bằng lệnh trong README.

---

**Ghi chú:** Đây là prompt tạo mã **FE + CSS** hoàn chỉnh, có mock API nội bộ để test. Khi có Spring Boot thật, chỉ cần thay endpoint trong `lib/api.ts` và bỏ mock routes.
